---
keywords: wave function python 
title: Wave function collapse
nb_path: _notebooks/2020-11-21-Wave-collapse-function-v2.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-11-21-Wave-collapse-function-v2.ipynb
-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>pip install numpy
<span class="o">!</span>pip install matplotlib
<span class="o">!</span>pip install seaborn
<span class="o">!</span>pip install scikit-image
<span class="o">!</span>pip install imageio
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Requirement already satisfied: numpy in ./venv/lib/python3.6/site-packages (1.19.4)
<span class="ansi-yellow-fg">You are using pip version 18.1, however version 20.3b1 is available.
You should consider upgrading via the &#39;pip install --upgrade pip&#39; command.</span>
Requirement already satisfied: matplotlib in ./venv/lib/python3.6/site-packages (3.3.2)
Requirement already satisfied: python-dateutil&gt;=2.1 in ./venv/lib/python3.6/site-packages (from matplotlib) (2.8.1)
Requirement already satisfied: numpy&gt;=1.15 in ./venv/lib/python3.6/site-packages (from matplotlib) (1.19.4)
Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,&gt;=2.0.3 in ./venv/lib/python3.6/site-packages (from matplotlib) (2.4.7)
Requirement already satisfied: certifi&gt;=2020.06.20 in ./venv/lib/python3.6/site-packages (from matplotlib) (2020.6.20)
Requirement already satisfied: kiwisolver&gt;=1.0.1 in ./venv/lib/python3.6/site-packages (from matplotlib) (1.3.1)
Requirement already satisfied: cycler&gt;=0.10 in ./venv/lib/python3.6/site-packages (from matplotlib) (0.10.0)
Requirement already satisfied: pillow&gt;=6.2.0 in ./venv/lib/python3.6/site-packages (from matplotlib) (8.0.1)
Requirement already satisfied: six&gt;=1.5 in ./venv/lib/python3.6/site-packages (from python-dateutil&gt;=2.1-&gt;matplotlib) (1.15.0)
<span class="ansi-yellow-fg">You are using pip version 18.1, however version 20.3b1 is available.
You should consider upgrading via the &#39;pip install --upgrade pip&#39; command.</span>
Requirement already satisfied: seaborn in ./venv/lib/python3.6/site-packages (0.11.0)
Requirement already satisfied: pandas&gt;=0.23 in ./venv/lib/python3.6/site-packages (from seaborn) (1.1.4)
Requirement already satisfied: numpy&gt;=1.15 in ./venv/lib/python3.6/site-packages (from seaborn) (1.19.4)
Requirement already satisfied: matplotlib&gt;=2.2 in ./venv/lib/python3.6/site-packages (from seaborn) (3.3.2)
Requirement already satisfied: scipy&gt;=1.0 in ./venv/lib/python3.6/site-packages (from seaborn) (1.5.4)
Requirement already satisfied: python-dateutil&gt;=2.7.3 in ./venv/lib/python3.6/site-packages (from pandas&gt;=0.23-&gt;seaborn) (2.8.1)
Requirement already satisfied: pytz&gt;=2017.2 in ./venv/lib/python3.6/site-packages (from pandas&gt;=0.23-&gt;seaborn) (2020.4)
Requirement already satisfied: kiwisolver&gt;=1.0.1 in ./venv/lib/python3.6/site-packages (from matplotlib&gt;=2.2-&gt;seaborn) (1.3.1)
Requirement already satisfied: certifi&gt;=2020.06.20 in ./venv/lib/python3.6/site-packages (from matplotlib&gt;=2.2-&gt;seaborn) (2020.6.20)
Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,&gt;=2.0.3 in ./venv/lib/python3.6/site-packages (from matplotlib&gt;=2.2-&gt;seaborn) (2.4.7)
Requirement already satisfied: cycler&gt;=0.10 in ./venv/lib/python3.6/site-packages (from matplotlib&gt;=2.2-&gt;seaborn) (0.10.0)
Requirement already satisfied: pillow&gt;=6.2.0 in ./venv/lib/python3.6/site-packages (from matplotlib&gt;=2.2-&gt;seaborn) (8.0.1)
Requirement already satisfied: six&gt;=1.5 in ./venv/lib/python3.6/site-packages (from python-dateutil&gt;=2.7.3-&gt;pandas&gt;=0.23-&gt;seaborn) (1.15.0)
<span class="ansi-yellow-fg">You are using pip version 18.1, however version 20.3b1 is available.
You should consider upgrading via the &#39;pip install --upgrade pip&#39; command.</span>
Requirement already satisfied: scikit-image in ./venv/lib/python3.6/site-packages (0.17.2)
Requirement already satisfied: scipy&gt;=1.0.1 in ./venv/lib/python3.6/site-packages (from scikit-image) (1.5.4)
Requirement already satisfied: tifffile&gt;=2019.7.26 in ./venv/lib/python3.6/site-packages (from scikit-image) (2020.9.3)
Requirement already satisfied: imageio&gt;=2.3.0 in ./venv/lib/python3.6/site-packages (from scikit-image) (2.9.0)
Requirement already satisfied: networkx&gt;=2.0 in ./venv/lib/python3.6/site-packages (from scikit-image) (2.5)
Requirement already satisfied: pillow!=7.1.0,!=7.1.1,&gt;=4.3.0 in ./venv/lib/python3.6/site-packages (from scikit-image) (8.0.1)
Requirement already satisfied: PyWavelets&gt;=1.1.1 in ./venv/lib/python3.6/site-packages (from scikit-image) (1.1.1)
Requirement already satisfied: numpy&gt;=1.15.1 in ./venv/lib/python3.6/site-packages (from scikit-image) (1.19.4)
Requirement already satisfied: matplotlib!=3.0.0,&gt;=2.0.0 in ./venv/lib/python3.6/site-packages (from scikit-image) (3.3.2)
Requirement already satisfied: decorator&gt;=4.3.0 in ./venv/lib/python3.6/site-packages (from networkx&gt;=2.0-&gt;scikit-image) (4.4.2)
Requirement already satisfied: python-dateutil&gt;=2.1 in ./venv/lib/python3.6/site-packages (from matplotlib!=3.0.0,&gt;=2.0.0-&gt;scikit-image) (2.8.1)
Requirement already satisfied: certifi&gt;=2020.06.20 in ./venv/lib/python3.6/site-packages (from matplotlib!=3.0.0,&gt;=2.0.0-&gt;scikit-image) (2020.6.20)
Requirement already satisfied: kiwisolver&gt;=1.0.1 in ./venv/lib/python3.6/site-packages (from matplotlib!=3.0.0,&gt;=2.0.0-&gt;scikit-image) (1.3.1)
Requirement already satisfied: cycler&gt;=0.10 in ./venv/lib/python3.6/site-packages (from matplotlib!=3.0.0,&gt;=2.0.0-&gt;scikit-image) (0.10.0)
Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,&gt;=2.0.3 in ./venv/lib/python3.6/site-packages (from matplotlib!=3.0.0,&gt;=2.0.0-&gt;scikit-image) (2.4.7)
Requirement already satisfied: six&gt;=1.5 in ./venv/lib/python3.6/site-packages (from python-dateutil&gt;=2.1-&gt;matplotlib!=3.0.0,&gt;=2.0.0-&gt;scikit-image) (1.15.0)
<span class="ansi-yellow-fg">You are using pip version 18.1, however version 20.3b1 is available.
You should consider upgrading via the &#39;pip install --upgrade pip&#39; command.</span>
Requirement already satisfied: imageio in ./venv/lib/python3.6/site-packages (2.9.0)
Requirement already satisfied: numpy in ./venv/lib/python3.6/site-packages (from imageio) (1.19.4)
Requirement already satisfied: pillow in ./venv/lib/python3.6/site-packages (from imageio) (8.0.1)
<span class="ansi-yellow-fg">You are using pip version 18.1, however version 20.3b1 is available.
You should consider upgrading via the &#39;pip install --upgrade pip&#39; command.</span>
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">one_iter_propagate</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">adj</span><span class="p">):</span>
    <span class="n">padded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                    <span class="n">wave</span><span class="p">,</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
    <span class="n">update</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">adj</span><span class="p">:</span>
        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">d</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">padded</span><span class="p">[</span>
            <span class="p">:,</span> <span class="p">(</span><span class="n">dx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):(</span><span class="n">wave</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">dy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):(</span><span class="n">wave</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  
        <span class="p">]</span>
        
        <span class="n">update</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">adj</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">@</span> <span class="n">current</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">adj</span><span class="p">:</span>
        <span class="n">wave</span> <span class="o">*=</span> <span class="n">update</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>
        
    <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">wave</span><span class="p">)</span>

        
<span class="k">def</span> <span class="nf">propagate</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">adj</span><span class="p">):</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">last_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">last_count</span> <span class="o">!=</span> <span class="n">wave</span><span class="o">.</span><span class="n">sum</span><span class="p">():</span>
        <span class="n">last_count</span> <span class="o">=</span> <span class="n">wave</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">one_iter_propagate</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">adj</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">show_state_map</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Contradiction found&quot;</span><span class="p">)</span>
            
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        
    <span class="k">return</span> <span class="n">count</span>

    
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">show_state_map</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">savefig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    
    <span class="n">state_size</span> <span class="o">=</span> <span class="n">wave</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;hls&quot;</span><span class="p">,</span> <span class="n">state_size</span><span class="p">)))</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">colors</span> <span class="k">else</span> <span class="n">colors</span>
    
    <span class="k">if</span> <span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">255.</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">255.</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mf">255.</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">colors</span> <span class="p">]</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">wave</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">wave</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">3</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">wave</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">selected_color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">wave</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                <span class="n">img</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">selected_color</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">img</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">wave</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">state_size</span><span class="p">)</span> <span class="k">if</span> <span class="n">wave</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
                
    <span class="n">patches</span> <span class="o">=</span> <span class="p">[</span><span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Class </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">state_size</span><span class="p">)]</span>
    <span class="n">mixed_color_patches</span> <span class="o">=</span> <span class="p">[]</span><span class="c1">#[mpatches.Patch(color=0.5 * colors[i] + 0.5 * colors[j], label=f&#39;Class {i}+{j}&#39;) for i in range(state_size) for j in range(state_size) if i &lt; j]</span>
    
    <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">patches</span> <span class="o">+</span> <span class="n">mixed_color_patches</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">savefig</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;./saved_figs&quot;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s2">&quot;./saved_figs&quot;</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">wave</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">wave</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;./saved_figs/fig_</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_propagate_iter</span><span class="p">():</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    
    <span class="n">prop_base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
          <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
           <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
           <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
           <span class="p">]</span>
    <span class="p">)</span>

    <span class="n">wave</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">wave</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="n">show_state_map</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>

    <span class="n">adj</span> <span class="o">=</span> <span class="p">{(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">prop_base</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">prop_base</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="n">prop_base</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="n">prop_base</span><span class="p">}</span>
    <span class="n">one_iter_propagate</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">adj</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">show_state_map</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="n">wave</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    
<span class="n">test_propagate_iter</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[0. 1. 1.]
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_full_propagate</span><span class="p">():</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    
    <span class="n">prop_base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
          <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
           <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
           <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
           <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
    <span class="p">)</span>
    
    <span class="n">wave</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">wave</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="n">show_state_map</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>

    <span class="n">adj</span> <span class="o">=</span> <span class="p">{(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">prop_base</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">prop_base</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="n">prop_base</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="n">prop_base</span><span class="p">}</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">propagate</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">adj</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">show_state_map</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">count</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
    
<span class="n">test_full_propagate</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>2
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">select_location</span><span class="p">(</span><span class="n">wave</span><span class="p">):</span>
    
    <span class="n">sub_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="mi">10000</span><span class="p">)</span>

    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">sub_index</span><span class="p">)</span>

    <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">index</span> <span class="o">/</span> <span class="n">wave</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">index</span> <span class="o">%</span> <span class="n">wave</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        
    <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
    

<span class="k">def</span> <span class="nf">choose_state</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">wave</span><span class="p">[:,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">]</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">norm_array</span> <span class="o">=</span> <span class="n">array</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    
    <span class="n">state_chosen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">norm_array</span><span class="p">)</span>
    <span class="n">wave</span><span class="p">[:,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">wave</span><span class="p">[</span><span class="n">state_chosen</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    

<span class="k">def</span> <span class="nf">wave_collapse_agorithm</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">adj</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    
    <span class="n">iteration</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">while</span> <span class="n">wave</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">wave</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">wave</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="k">if</span><span class="p">(</span><span class="n">iteration</span> <span class="o">%</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">show</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">show_state_map</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Iteration </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
        <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">select_location</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
        
        <span class="n">choose_state</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">show_state_map</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">savefig</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="n">propagate</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">adj</span><span class="p">)</span>
        <span class="n">iteration</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="k">if</span> <span class="n">iteration</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">wave</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">wave</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="k">break</span>
        
    
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_full_algorithm</span><span class="p">():</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    
    <span class="n">prop_base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
          <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
           <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
           <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>


    <span class="n">show_state_map</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>

    <span class="n">adj</span> <span class="o">=</span> <span class="p">{(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">prop_base</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">prop_base</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="n">prop_base</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="n">prop_base</span><span class="p">}</span>
    
    
    <span class="n">wave_collapse_agorithm</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">adj</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
    <span class="n">show_state_map</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
    
<span class="n">test_full_algorithm</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Iteration 0
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">----------------------------------------</span>
<span class="ansi-red-fg">NameError</span>Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-8-66e58c0881d1&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     19</span>     show_state_map<span class="ansi-blue-fg">(</span>wave<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     20</span> 
<span class="ansi-green-fg">---&gt; 21</span><span class="ansi-red-fg"> </span>test_full_algorithm<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-8-66e58c0881d1&gt;</span> in <span class="ansi-cyan-fg">test_full_algorithm</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">     13</span> 
<span class="ansi-green-intense-fg ansi-bold">     14</span> 
<span class="ansi-green-fg">---&gt; 15</span><span class="ansi-red-fg">     </span>wave_collapse_agorithm<span class="ansi-blue-fg">(</span>wave<span class="ansi-blue-fg">,</span> adj<span class="ansi-blue-fg">,</span> save<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     16</span> 
<span class="ansi-green-intense-fg ansi-bold">     17</span>     plt<span class="ansi-blue-fg">.</span>figure<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-7-6e163844b167&gt;</span> in <span class="ansi-cyan-fg">wave_collapse_agorithm</span><span class="ansi-blue-fg">(wave, adj, show, save)</span>
<span class="ansi-green-intense-fg ansi-bold">     37</span> 
<span class="ansi-green-intense-fg ansi-bold">     38</span>         <span class="ansi-green-fg">if</span> save<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 39</span><span class="ansi-red-fg">             </span>show_state_map<span class="ansi-blue-fg">(</span>wave<span class="ansi-blue-fg">,</span> savefig<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     40</span> 
<span class="ansi-green-intense-fg ansi-bold">     41</span>         propagate<span class="ansi-blue-fg">(</span>wave<span class="ansi-blue-fg">,</span> adj<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-4-ddc1886c4b0d&gt;</span> in <span class="ansi-cyan-fg">show_state_map</span><span class="ansi-blue-fg">(wave, colors, legend, savefig, ax)</span>
<span class="ansi-green-intense-fg ansi-bold">     23</span> 
<span class="ansi-green-intense-fg ansi-bold">     24</span>     <span class="ansi-green-fg">if</span> savefig<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 25</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> os<span class="ansi-blue-fg">.</span>path<span class="ansi-blue-fg">.</span>exists<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;./saved_figs&#34;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     26</span>             os<span class="ansi-blue-fg">.</span>mkdir<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;./saved_figs&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     27</span>         index <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">(</span>wave<span class="ansi-blue-fg">.</span>shape<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">*</span> wave<span class="ansi-blue-fg">.</span>shape<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">*</span> wave<span class="ansi-blue-fg">.</span>shape<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-</span> np<span class="ansi-blue-fg">.</span>sum<span class="ansi-blue-fg">(</span>wave<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;os&#39; is not defined</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">imageio</span>

<span class="n">image_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./saved_figs&#39;</span><span class="p">)</span>
<span class="n">images</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">image_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*.png&#39;</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">image_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
    <span class="n">image_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span>
    
<span class="n">imageio</span><span class="o">.</span><span class="n">mimwrite</span><span class="p">(</span><span class="s1">&#39;animated_from_images.gif&#39;</span><span class="p">,</span> <span class="n">image_list</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">image_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./saved_figs&#39;</span><span class="p">)</span>

<span class="n">l</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">image_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*.png&#39;</span><span class="p">))</span>

<span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">dir</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Part-2-:-Adding-patterns">Part 2 : Adding patterns<a class="anchor-link" href="#Part-2-:-Adding-patterns"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">ffrom_wave_to_patterns</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">pattern_map</span><span class="p">,</span> <span class="n">pattern_size</span><span class="p">):</span>
    <span class="n">index_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="n">w</span> <span class="o">=</span> <span class="n">wave</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">pattern_size</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">wave</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">pattern_size</span>
    
    <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">index_img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">index_img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">index_img</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern_map</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">img</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">pattern_size</span><span class="p">:</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">pattern_size</span><span class="p">,</span> <span class="n">j</span> <span class="o">*</span> <span class="n">pattern_size</span><span class="p">:</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">pattern_size</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">pattern</span>
            
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

<span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">wave</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">pattern_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span> 
               <span class="mi">1</span><span class="p">:</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span> 
               <span class="mi">2</span><span class="p">:</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">4</span><span class="p">))}</span>
<span class="n">ffrom_wave_to_patterns</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">pattern_map</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">io</span>
<span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">transform</span>
<span class="kn">import</span> <span class="nn">os</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">buid_arrow_collection</span><span class="p">(</span><span class="n">pattern_size</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">dir_location</span><span class="o">=</span><span class="s2">&quot;/Users/a.morvan/Documents/code_dw/notebook_and_scripts_collections/wave_function_collapse/imgs/arrows/&quot;</span><span class="p">):</span>
    <span class="n">pattern_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">extension</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;up&quot;</span><span class="p">,</span> <span class="s2">&quot;down&quot;</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]):</span>
        <span class="n">file_loc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_location</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;arrow_</span><span class="si">{</span><span class="n">extension</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">file_loc</span><span class="p">)</span>
        <span class="n">arrow</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">file_loc</span><span class="p">)</span>    
        <span class="n">arrow_resize</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">arrow</span><span class="p">,</span> <span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="n">anti_aliasing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="n">pattern_map</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">arrow_resize</span>
        
    <span class="k">return</span> <span class="n">pattern_map</span>
    
<span class="n">pattern_map</span> <span class="o">=</span> <span class="n">buid_arrow_collection</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pattern_map</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">ffrom_wave_to_patterns</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">pattern_map</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Part-3-:-Read-pattern-from-an-image-and-generate-new">Part 3 : Read pattern from an image and generate new<a class="anchor-link" href="#Part-3-:-Read-pattern-from-an-image-and-generate-new"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">build_map_from_img</span><span class="p">(</span><span class="n">img_path</span><span class="p">,</span> <span class="n">pattern_size</span><span class="p">,</span> <span class="n">nb_pattern</span><span class="p">):</span>
    
    <span class="n">img</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>
    
    
    
    
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">img</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;/Users/a.morvan/Documents/code_dw/notebook_and_scripts_collections/wave_function_collapse/imgs/wall/pattern.png&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="p">[:</span><span class="mi">20</span><span class="p">,</span> <span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="p">:]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pattern_size</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">patterns</span> <span class="o">=</span> <span class="p">[</span><span class="n">img</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">pattern_size</span><span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">pattern_size</span><span class="p">,</span> <span class="n">j</span> <span class="o">*</span> <span class="n">pattern_size</span><span class="p">:</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">pattern_size</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>


<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">patterns</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">quantify</span><span class="p">(</span><span class="n">my_img</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">32</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">q</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">my_img</span> <span class="o">//</span> <span class="n">q</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img</span><span class="p">))</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">quantify</span><span class="p">(</span><span class="n">img</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_patterns</span><span class="p">(</span><span class="n">my_img</span><span class="p">,</span> <span class="n">pattern_size</span><span class="p">):</span>
    <span class="n">max_i</span> <span class="o">=</span> <span class="n">my_img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="n">pattern_size</span>
    <span class="n">max_j</span> <span class="o">=</span> <span class="n">my_img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="n">pattern_size</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">my_img</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">pattern_size</span><span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">pattern_size</span><span class="p">,</span> <span class="n">j</span> <span class="o">*</span> <span class="n">pattern_size</span><span class="p">:</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">pattern_size</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_j</span><span class="p">)]</span>

<span class="n">patterns</span> <span class="o">=</span> <span class="n">get_patterns</span><span class="p">(</span><span class="n">quantify</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">patterns</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">patterns</span> <span class="o">=</span> <span class="n">get_patterns</span><span class="p">(</span><span class="n">quantify</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">patterns</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">p2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">patterns</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">p1</span> <span class="o">==</span> <span class="n">p2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">patterns</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">build_adj_based_on_img</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span> 
    
    <span class="k">def</span> <span class="nf">is_in_area</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">h</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">j</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="n">w</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">to_index</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">u</span> <span class="o">*</span> <span class="n">w</span> <span class="o">+</span> <span class="n">v</span>
    
    <span class="n">nb_patterns</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">w</span>
    
    <span class="n">adj</span> <span class="o">=</span> <span class="p">{(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nb_patterns</span><span class="p">,</span> <span class="n">nb_patterns</span><span class="p">)),</span>
           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nb_patterns</span><span class="p">,</span> <span class="n">nb_patterns</span><span class="p">)),</span>
           <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nb_patterns</span><span class="p">,</span> <span class="n">nb_patterns</span><span class="p">)),</span>
           <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nb_patterns</span><span class="p">,</span> <span class="n">nb_patterns</span><span class="p">)),</span>
          <span class="p">}</span>
    
    <span class="k">for</span> <span class="n">direction</span> <span class="ow">in</span> <span class="n">adj</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
                
                <span class="nb">print</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
                
                <span class="n">new_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">direction</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">j</span> <span class="o">+</span> <span class="n">direction</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                
                
                
                <span class="k">if</span> <span class="n">is_in_area</span><span class="p">(</span><span class="n">new_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">new_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---&gt; &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---&gt;&gt; &quot;</span><span class="p">,</span> <span class="n">new_point</span><span class="p">,</span> <span class="n">to_index</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">to_index</span><span class="p">(</span><span class="n">new_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">new_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">adj</span><span class="p">[</span><span class="n">direction</span><span class="p">][</span><span class="n">to_index</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">to_index</span><span class="p">(</span><span class="n">new_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">new_point</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span> <span class="o">=</span> <span class="mi">1</span>
                    
    <span class="k">return</span> <span class="n">adj</span>
                
    
         

<span class="n">adj</span> <span class="o">=</span> <span class="n">build_adj_based_on_img</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">adj</span><span class="p">[(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">adj</span><span class="p">[(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">adj</span><span class="p">[(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Part-2-alternate-:-vertical-world">Part 2 alternate : vertical world<a class="anchor-link" href="#Part-2-alternate-:-vertical-world"> </a></h1><p>A set of colors can be stacked one upon another with strict order</p>
<p>bottom = brown &lt;= green &lt;= blue = top</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">COLORS</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">96</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">42</span><span class="p">),</span> <span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">96</span><span class="p">)]</span>


<span class="c1"># Bottom rule : yourself or the previous one</span>
<span class="n">bottom_rule</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
          <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
           <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
           <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
    <span class="p">)</span>
<span class="c1"># top rule : yourself or the next one</span>
<span class="n">top_rule</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
          <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
           <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
           <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
    <span class="p">)</span>
<span class="c1"># Side rule : anyone</span>
<span class="n">side_rule</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
          <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
           <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
           <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
    <span class="p">)</span>


<span class="n">adj</span> <span class="o">=</span> <span class="p">{(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">bottom_rule</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">top_rule</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="n">side_rule</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="n">side_rule</span><span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">wave_collapse_agorithm</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">adj</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">show_state_map</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">build_vertical_rules</span><span class="p">(</span><span class="n">n_colors</span><span class="p">):</span>
    
    <span class="n">bottom_rule</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n_colors</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_colors</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">bottom_rule</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        
    <span class="n">top_rule</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n_colors</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_colors</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">top_rule</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        
    <span class="n">side_rule</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n_colors</span><span class="p">,</span> <span class="n">n_colors</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">bottom_rule</span><span class="p">,</span> <span class="n">top_rule</span><span class="p">,</span> <span class="n">side_rule</span>


<span class="k">def</span> <span class="nf">build_vertical_world</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    
    <span class="c1"># Define vars of the pb</span>
    <span class="n">n_tiles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n_tiles</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>

    <span class="c1"># Build adjacency matric</span>
    <span class="n">bottom_rule</span><span class="p">,</span> <span class="n">top_rule</span><span class="p">,</span> <span class="n">side_rule</span> <span class="o">=</span> <span class="n">build_vertical_rules</span><span class="p">(</span><span class="n">n_tiles</span><span class="p">)</span>
    <span class="n">adj</span> <span class="o">=</span> <span class="p">{(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">bottom_rule</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">top_rule</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="n">side_rule</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="n">side_rule</span><span class="p">}</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="n">bottom_rule</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="c1"># Define the bottom of the map as layer 0</span>
    <span class="n">wave</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">propagate</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">adj</span><span class="p">)</span>
    
    <span class="c1"># Run the wave collapse alg</span>
    <span class="n">wave_collapse_agorithm</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">adj</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
    <span class="n">show_state_map</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">colors</span><span class="p">)</span>



<span class="n">build_vertical_world</span><span class="p">(</span><span class="n">COLORS</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">color_palette_build</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">b</span><span class="p">:</span> <span class="p">[(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">),</span> <span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">r</span><span class="p">)]</span>

<span class="n">COLORS</span> <span class="o">=</span> <span class="n">color_palette_build</span><span class="p">(</span><span class="mi">214</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">159</span><span class="p">)</span>

<span class="n">build_vertical_world</span><span class="p">(</span><span class="n">COLORS</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">COLORS</span> <span class="o">=</span> <span class="n">color_palette_build</span><span class="p">(</span><span class="mi">228</span><span class="p">,</span> <span class="mi">229</span><span class="p">,</span> <span class="mi">190</span><span class="p">)</span>

<span class="n">build_vertical_world</span><span class="p">(</span><span class="n">COLORS</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">multiple_color_palette_build</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span>  <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
<span class="n">my_colors</span> <span class="o">=</span> <span class="n">multiple_color_palette_build</span><span class="p">(</span><span class="mi">228</span><span class="p">,</span> <span class="mi">229</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">my_colors</span><span class="p">)</span>

<span class="n">build_vertical_world</span><span class="p">(</span><span class="n">my_colors</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="3---Handling-of-symetry">3 - Handling of symetry<a class="anchor-link" href="#3---Handling-of-symetry"> </a></h1><p>This can be easily applied to domino-like tiles.
They need a matching number in order to be connected together.</p>
<p>Symmetry rules are defined on top of connected-or-not rules between tiles.
To simplify our example, we will keep only 1-0 connections</p>

<pre><code> up right down left 
</code></pre>
<p>T = [0   1.    1.   1. ]</p>
<p>We can deduce connectivity of rotated version of T</p>

<pre><code>   up right down left 
</code></pre>
<ul>
<li>T  = [0   1.    1.   1. ]</li>
<li>|- = [1   1.    1.   0. ] rotated right once 90° </li>
<li>| =  [1   1.    0.   1. ] rotated right twice 90° </li>
<li>-| = [1   0.    1.   1. ] rotated right thrice 90° </li>
</ul>
<p>To find connections between symmetric transformation of peices we can use the following rule building :</p>
<ul>
<li>Right connection T and |-  == M[0, right] * M[1, left]</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">UP</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">RIGHT</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">DOWN</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">LEFT</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">T_CONNECTIVITY</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">ROT_90_MAT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ROT_90_MAT</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">T_CONNECTIVITY</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">build_all_rotations</span><span class="p">(</span><span class="n">ref_pieces</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">ref_pieces</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span>
    <span class="n">result_array</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ref_piece</span> <span class="ow">in</span> <span class="n">ref_pieces</span><span class="p">:</span>
        <span class="n">result_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ref_piece</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">kept</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">keep</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="k">if</span> <span class="n">kept</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">ROT_90_MAT</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">result_array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">result_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result_array</span>


<span class="n">build_all_rotations</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">T_CONNECTIVITY</span><span class="p">)])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">direction_dictionnary</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">3</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">3</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">build_adj_from_number_vec</span><span class="p">(</span><span class="n">vector_array</span><span class="p">):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vector_array</span><span class="p">)</span>
    <span class="n">adj</span> <span class="o">=</span> <span class="p">{</span><span class="n">direction</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span> <span class="k">for</span> <span class="n">direction</span> <span class="ow">in</span> <span class="n">direction_dictionnary</span><span class="o">.</span><span class="n">values</span><span class="p">()}</span>
    <span class="k">for</span> <span class="n">direction_index</span><span class="p">,</span> <span class="n">direction</span> <span class="ow">in</span> <span class="n">direction_dictionnary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="n">adj</span><span class="p">[</span><span class="n">direction</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">vector_array</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">direction_index</span><span class="p">]</span> <span class="o">==</span> <span class="n">vector_array</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">direction_index</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span><span class="p">]</span> 
    <span class="k">return</span> <span class="n">adj</span>
    
    
<span class="n">adj</span> <span class="o">=</span> <span class="n">build_adj_from_number_vec</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">build_all_rotations</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">T_CONNECTIVITY</span><span class="p">))))</span>
<span class="n">adj</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Run the wave collapse alg</span>
<span class="n">wave_collapse_agorithm</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">adj</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">show_state_map</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">skimage.transform</span> <span class="kn">import</span> <span class="n">rotate</span>

<span class="k">def</span> <span class="nf">buid_rotated_collection</span><span class="p">(</span><span class="n">pattern_size</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">img_path</span><span class="o">=</span><span class="s2">&quot;/Users/a.morvan/Documents/code_dw/notebook_and_scripts_collections/wave_function_collapse/imgs/pipe/T_up.png&quot;</span><span class="p">):</span>
    <span class="n">pic</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>  
    <span class="n">pic_resize</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">pic</span><span class="p">,</span> <span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="n">anti_aliasing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pattern_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">angle</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">270</span><span class="p">]):</span>
        <span class="n">pattern_map</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">pic_resize</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>   
        
    <span class="k">return</span> <span class="n">pattern_map</span>

<span class="n">pattern_map</span> <span class="o">=</span> <span class="n">buid_rotated_collection</span><span class="p">()</span>
<span class="n">ffrom_wave_to_patterns</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">pattern_map</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">L_CONNECTIVITY</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>


<span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">build_all_rotations</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">T_CONNECTIVITY</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">L_CONNECTIVITY</span><span class="p">)]))</span>

<span class="n">adj</span> <span class="o">=</span> <span class="n">build_adj_from_number_vec</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>


<span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Run the wave collapse alg</span>
<span class="n">excepted</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">excepted</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">wave_collapse_agorithm</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">adj</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">excepted</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="k">break</span>


<span class="c1">#plt.figure(figsize=(20,20))</span>
<span class="n">show_state_map</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">pattern_map_1</span> <span class="o">=</span> <span class="n">buid_rotated_collection</span><span class="p">(</span><span class="n">img_path</span><span class="o">=</span><span class="s2">&quot;/Users/a.morvan/Documents/code_dw/notebook_and_scripts_collections/wave_function_collapse/imgs/pipe/gold_T_up.png&quot;</span><span class="p">)</span>
<span class="n">pattern_map_2</span> <span class="o">=</span> <span class="n">buid_rotated_collection</span><span class="p">(</span><span class="n">img_path</span><span class="o">=</span><span class="s2">&quot;/Users/a.morvan/Documents/code_dw/notebook_and_scripts_collections/wave_function_collapse/imgs/pipe/gold_L_up.png&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">pattern_map_2</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">pattern_map_1</span><span class="p">[</span><span class="mi">4</span> <span class="o">+</span> <span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">img</span>


<span class="n">ffrom_wave_to_patterns</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">pattern_map_1</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Handling-more-symetry-with-1-to-many-relation-with-tiles">Handling more symetry with 1-to-many relation with tiles<a class="anchor-link" href="#Handling-more-symetry-with-1-to-many-relation-with-tiles"> </a></h1><p>Challenges</p>
<ul>
<li>Not all symetries are needed for dot and I pattern, we need to to do it properly to reduce pb size</li>
<li>Need to modify the pattern filling function to choose between two (or more) possible patterns</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Data-structure">Data structure<a class="anchor-link" href="#Data-structure"> </a></h3><p>Dictionary like</p>

<pre><code>{L -&gt; [rotated_matrices], X -&gt; [...]}

adj, letter_to_index = build_adj_from_number_vec(...)</code></pre>
<p>letter_to_index = {L_0°: 0, L_90°: 1, ...}</p>

<pre><code>tiles = {L_0° -&gt; [tile_1, tile_2], L_90° -&gt; [tile_1_90 ..], X -&gt; [X_up]}
build_patterns(wave, tiles`</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Handling-Different-symetries">Handling Different symetries<a class="anchor-link" href="#Handling-Different-symetries"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">build_symetry_set</span><span class="p">():</span>

    <span class="c1"># 4 elements created</span>
    <span class="n">T_CONNECTIVITY</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">L_CONNECTIVITY</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># 2 elements created</span>
    <span class="n">I_CONNECTIVITY</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># 1 element created</span>
    <span class="n">X_CONNECTIVITY</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">ANTIX_CONNECTIVITY</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">build_all_rotations</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">T_CONNECTIVITY</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">L_CONNECTIVITY</span><span class="p">)]))</span>
    <span class="n">array_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">build_all_rotations</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">I_CONNECTIVITY</span><span class="p">)],</span> <span class="n">keep</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>

    <span class="n">final_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">array</span><span class="p">,</span> <span class="n">array_2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X_CONNECTIVITY</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ANTIX_CONNECTIVITY</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="n">index_dict</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;T_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)}</span>
    <span class="n">index_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="sa">f</span><span class="s2">&quot;L_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">j</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">))})</span>
    <span class="n">index_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="sa">f</span><span class="s2">&quot;I_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">j</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">))})</span>
    <span class="n">index_dict</span><span class="p">[</span><span class="s2">&quot;X_0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">index_dict</span><span class="p">[</span><span class="s2">&quot;AX_0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11</span>
    
    <span class="n">array_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">final_array</span><span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="p">:]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">index_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="k">return</span> <span class="n">array_dict</span><span class="p">,</span> <span class="n">index_dict</span>
    
<span class="k">def</span> <span class="nf">define_tile_set</span><span class="p">(</span><span class="n">tile_dict</span><span class="p">,</span> <span class="n">array_dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    We expect something like </span>
<span class="sd">    tile_dict = {&quot;T&quot;: [&quot;file_1.jpg&quot;, &quot;file_2.jpg&quot;], ....}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">found_letters</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">tile_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">sub_array</span> <span class="o">=</span> <span class="p">[</span><span class="n">array_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">array_dict</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">found_letters</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">sub_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 


<span class="k">def</span> <span class="nf">run_wave_collapse</span><span class="p">(</span><span class="n">my_adj</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
    <span class="n">n_tiles</span> <span class="o">=</span> <span class="n">my_adj</span><span class="p">[(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n_tiles</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">))</span>

    <span class="c1"># Run the wave collapse alg</span>
    <span class="n">excepted</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">excepted</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">wave_collapse_agorithm</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">my_adj</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">excepted</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n_tiles</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">))</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                <span class="k">break</span>
    <span class="k">return</span> <span class="n">wave</span>

<span class="k">def</span> <span class="nf">build_rotated_collection</span><span class="p">(</span><span class="n">tile_dict</span><span class="p">,</span> <span class="n">index_dict</span><span class="p">,</span> <span class="n">img_size</span><span class="o">=</span><span class="mi">40</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    tile_dict = {&quot;T&quot;: [&quot;file_1.jpg&quot;, &quot;file_2.jpg&quot;], ....}</span>
<span class="sd">    index_dict = {&quot;T_0&quot;: 0, ..., &quot;AX_0&quot;: 11}</span>
<span class="sd">    </span>
<span class="sd">    out: {0: [img1, img2], ...}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pattern_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">list</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">index_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()}</span>
    <span class="k">for</span> <span class="n">tile_type</span><span class="p">,</span> <span class="n">filepaths</span> <span class="ow">in</span> <span class="n">tile_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="n">filepaths</span><span class="p">:</span>
            <span class="n">pic</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
            <span class="n">pic_resized</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">pic</span><span class="p">,</span> <span class="p">(</span><span class="n">img_size</span><span class="p">,</span> <span class="n">img_size</span><span class="p">),</span> <span class="n">anti_aliasing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">angle</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">270</span><span class="p">]):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tile_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">index_dict</span><span class="p">:</span>
                    <span class="n">pattern_map</span><span class="p">[</span><span class="n">index_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rotate</span><span class="p">(</span><span class="n">pic_resized</span><span class="p">,</span> <span class="n">angle</span><span class="p">))</span>
                
    <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">pattern_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">}</span>


<span class="k">def</span> <span class="nf">build_final_img</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">pattern_map</span><span class="p">,</span> <span class="n">pattern_size</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">n_channels</span> <span class="o">=</span> <span class="n">pattern_map</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n_channels&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">pattern_map</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pattern_map</span><span class="p">))])</span>
    <span class="n">index_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="n">w</span> <span class="o">=</span> <span class="n">wave</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">pattern_size</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">wave</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">pattern_size</span>
    
    <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">n_channels</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">index_img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">index_img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">index_img</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
            <span class="n">tile_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pattern_map</span><span class="p">[</span><span class="n">index</span><span class="p">])))</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern_map</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">tile_index</span><span class="p">]</span>
            <span class="n">img</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">pattern_size</span><span class="p">:</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">pattern_size</span><span class="p">,</span> <span class="n">j</span> <span class="o">*</span> <span class="n">pattern_size</span><span class="p">:</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">pattern_size</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">pattern</span>
            
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tile_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;T&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;/Users/a.morvan/Documents/code_dw/notebook_and_scripts_collections/wave_function_collapse/imgs/pipe/gold_T_up.png&quot;</span><span class="p">],</span>
             <span class="s2">&quot;L&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;/Users/a.morvan/Documents/code_dw/notebook_and_scripts_collections/wave_function_collapse/imgs/pipe/gold_L_up.png&quot;</span><span class="p">]}</span>
<span class="n">array_dict</span><span class="p">,</span> <span class="n">index_dict</span> <span class="o">=</span> <span class="n">build_symetry_set</span><span class="p">()</span>
<span class="n">array</span> <span class="o">=</span> <span class="n">define_tile_set</span><span class="p">(</span><span class="n">tile_dict</span><span class="p">,</span> <span class="n">array_dict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
<span class="n">adj</span> <span class="o">=</span> <span class="n">build_adj_from_number_vec</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>

<span class="n">wave</span> <span class="o">=</span> <span class="n">run_wave_collapse</span><span class="p">(</span><span class="n">adj</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="n">pattern_map</span> <span class="o">=</span> <span class="n">build_rotated_collection</span><span class="p">(</span><span class="n">tile_dict</span><span class="p">,</span> <span class="n">index_dict</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">build_final_img</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">pattern_map</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dir_</span> <span class="o">=</span> <span class="s2">&quot;/Users/a.morvan/Documents/code_dw/notebook_and_scripts_collections/wave_function_collapse/imgs&quot;</span>
<span class="n">tile_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;T&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;racing/T_0_up.png&quot;</span><span class="p">]],</span>
             <span class="s2">&quot;L&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;racing/L_0_up.jpg&quot;</span><span class="p">]],</span>
             <span class="s2">&quot;I&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;racing/I_0_up.jpg&quot;</span><span class="p">]],</span>
             <span class="s2">&quot;X&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;racing/X_0.png&quot;</span><span class="p">]],</span>
             <span class="s2">&quot;AX&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;racing/AX_0.jpg&quot;</span><span class="p">]],</span>     <span class="p">}</span>
<span class="n">array_dict</span><span class="p">,</span> <span class="n">index_dict</span> <span class="o">=</span> <span class="n">build_symetry_set</span><span class="p">()</span>
<span class="n">array</span> <span class="o">=</span> <span class="n">define_tile_set</span><span class="p">(</span><span class="n">tile_dict</span><span class="p">,</span> <span class="n">array_dict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
<span class="n">adj</span> <span class="o">=</span> <span class="n">build_adj_from_number_vec</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adj</span><span class="p">[(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">wave</span> <span class="o">=</span> <span class="n">run_wave_collapse</span><span class="p">(</span><span class="n">adj</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">pattern_map</span> <span class="o">=</span> <span class="n">build_rotated_collection</span><span class="p">(</span><span class="n">tile_dict</span><span class="p">,</span> <span class="n">index_dict</span><span class="p">,</span> <span class="n">img_size</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="n">build_final_img</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">pattern_map</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>

<span class="n">show_state_map</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">block_size</span> <span class="o">=</span> <span class="mi">100</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span><span class="mi">40</span><span class="p">))</span>
<span class="n">pattern_map</span> <span class="o">=</span> <span class="n">build_rotated_collection</span><span class="p">(</span><span class="n">tile_dict</span><span class="p">,</span> <span class="n">index_dict</span><span class="p">,</span> <span class="n">img_size</span><span class="o">=</span><span class="n">block_size</span><span class="p">)</span>
<span class="n">build_final_img</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">pattern_map</span><span class="p">,</span> <span class="n">block_size</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">pattern_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

